# **TypeBox**

## **1. プロジェクト概要**

### **目的**
- MBTI診断を通じて自己理解を深め、その結果を共有・分析できるプラットフォームを提供。

### **対象ユーザー**
- **ログイン済みユーザー**
  - GitHub、Google、MicrosoftのOAuthを使用して認証。

### **認証**
- OAuthを活用した安全な認証システムを採用。
- 初回ログイン時にユーザー情報をデータベースに登録。

---

## **2. 機能要件**

### **1. 診断機能**
1. **診断開始**
   - ログイン後、診断を開始可能。
   - 診断セッションIDをユーザーIDと紐付けてサーバーで管理。
2. **質問リストの表示**
   - 質問をリアルタイムでサーバーに送信し、進行状況を記録。
3. **進行状況の可視化**
   - プログレスバーや数値表示で進行状況を可視化。
4. **診断結果の計算**
   - サーバー側で回答を集計し、MBTIタイプを計算・表示。
5. **一時保存機能**
   - 「一時保存」ボタンまたは自動保存により進行状況を保存。
   - ログイン後に保存データをロードして再開可能。
6. **診断結果の履歴管理**
   - ユーザーごとに過去の診断結果をデータベースに保存。
   - 履歴をフィルタリング・ソートして表示。

---

### **2. タイプ確認機能**
1. **診断結果の詳細表示**
   - MBTIタイプの特性、適性職業、相性情報などを提供。
2. **診断履歴の管理**
   - 過去の診断結果を閲覧・削除可能。
3. **相性確認**
   - 他のタイプとの相性を表示。

---

### **3. グループ機能**
1. **グループ作成**
   - ユーザーがグループを作成可能（名前と説明文を設定）。
   - 招待元ユーザーがメンバーをアプリ内通知で招待。
2. **招待リクエストの送信**
   - 招待の成否に関わらず、統一メッセージを返す:
     - 「招待のリクエストを受け付けました。詳細は後ほど通知します。」
3. **非同期処理と通知**
   - 招待リクエストを非同期で処理。
   - 存在するユーザーのみ以下の通知を送信:
     - 招待元ユーザー: 「招待が送信されました。」
     - 招待先ユーザー: アプリ内通知で「[グループ名]に招待されました。」
4. **招待リクエストの無効化**
   - 存在しないユーザーや不正なリクエストは無視。
   - ログ記録のみ行い、通知は行わない。
5. **ブルートフォース防止**
   - レート制限を適用（例: 1分間に5件まで）。
   - 必要に応じてCAPTCHAを導入。
6. **相性診断**
   - グループ内のメンバー同士のMBTI相性を計算し、一覧で表示。
   - 相性スコアや簡単な解説を提供。
7. **相関図作成**
   - グループ内のメンバー間の相性を相関図として可視化。
   - ノード（ユーザー）とエッジ（相性スコア）を用いたグラフ形式を採用。
   - メンバー追加・削除時にリアルタイムで相関図を更新。

---

## **3. 非機能要件**

### **1. セキュリティ**
- **ユーザー存在の秘匿**:
  - 招待リクエストの結果に関わらず、同一のレスポンスを返す。
- **レート制限**:
  - 招待リクエストの頻度を制限し、ブルートフォース攻撃を防止。
- **CAPTCHAの導入**:
  - 必要に応じて不正なプログラムのリクエストを防ぐ。
- **ログ記録**:
  - 不正なリクエストや存在しないユーザーへの招待はすべて記録し、監視可能にする。

---

### **2. パフォーマンス**
- 非同期処理を活用してサーバー負荷を分散。
- 効率的なレートリミッターを実装。

---

### **3. アクセシビリティ**
- 招待フォームやエラーメッセージは、視覚障害者やスクリーンリーダーユーザーにも対応。

---

## **4. 技術スタック**

### **フロントエンド**
- フレームワーク: Next.js（TypeScript）
- 認証ライブラリ: `next-auth`

### **バックエンド**
- APIサーバー: Azure Functions
- データベース: Azure SQL Database

### **通知機能**
- **アプリ内通知**:
  - グループ招待や承認状態を通知。
  - 通知履歴を保存し、リアルタイムで表示。

---

## **5. UI案**
1. **ログイン画面**
   - 「GitHub」「Google」「Microsoft」のログインボタンを配置。
2. **診断画面**
   - 質問、進行状況、一時保存ボタンを表示。
3. **履歴画面**
   - 保存済み診断データの一覧を表示し、再開・削除可能。
4. **招待通知画面**
   - アプリ内通知一覧を表示し、招待の承認または拒否が可能。
5. **グループ詳細画面**
   - メンバー間の相性診断結果をテーブル形式で表示。
   - 相関図をグラフとして表示（リアルタイム更新）。